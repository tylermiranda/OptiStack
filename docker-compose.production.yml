# OptiStack - Production Docker Compose
#
# Usage:
#   1. Download this file: curl -O https://raw.githubusercontent.com/tylermiranda/OptiStack/main/docker-compose.production.yml
#   2. Copy .env.example and configure: curl -O https://raw.githubusercontent.com/tylermiranda/OptiStack/main/.env.example && cp .env.example .env
#   3. Edit .env with your settings
#   4. Run: docker compose -f docker-compose.production.yml up -d
#
# The image is automatically pulled from GitHub Container Registry.

services:
  optistack:
    image: ghcr.io/tylermiranda/optistack:latest
    container_name: optistack
    ports:
      - "${PORT:-3000}:${PORT:-3000}"
    env_file:
      - .env
    environment:
      - PORT=${PORT:-3000}
      - FRONTEND_URL=${FRONTEND_URL:-http://localhost:${PORT:-3000}}
      - OIDC_CALLBACK_URL=${OIDC_CALLBACK_URL:-http://localhost:${PORT:-3000}/auth/callback}
    volumes:
      # Persist database across container restarts
      - optistack_data:/app/data
    restart: unless-stopped
    healthcheck:
      test: [ "CMD", "curl", "-f", "http://localhost:${PORT:-3000}/" ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

volumes:
  optistack_data:
