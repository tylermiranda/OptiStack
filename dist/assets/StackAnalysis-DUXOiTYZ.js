import{c as H,u as P,r as x,j as e,D as J,a as U,b as W,d as q,C as G,T as K,e as V,f as Y,g as I,S as C,A as M,h as Z,B as Q}from"./index-Bbx85iqt.js";/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const u=H("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=H("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),X=({open:d,onOpenChange:f})=>{const{token:h}=P(),[o,y]=x.useState([]),[k,j]=x.useState(!1),[p,b]=x.useState(null);x.useEffect(()=>{d&&h&&z()},[d,h]);const z=async()=>{j(!0);try{const s=await fetch("/api/ai/analysis-history",{headers:{Authorization:`Bearer ${h}`}});if(s.ok){const l=await s.json();y(l)}}catch(s){console.error("Failed to fetch analysis history:",s)}finally{j(!1)}},S=async s=>{try{(await fetch(`/api/ai/analysis-history/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${h}`}})).ok&&(y(o.filter(i=>i.id!==s)),p===s&&b(null))}catch(l){console.error("Failed to delete analysis:",l)}},A=s=>new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"}),O=s=>{b(p===s?null:s)};return e.jsx(J,{open:d,onOpenChange:f,children:e.jsxs(U,{className:"max-h-[90vh] overflow-y-auto w-[95vw] sm:max-w-2xl",children:[e.jsx(W,{children:e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(E,{size:20}),"Analysis History"]})}),k?e.jsx("div",{className:"py-8 text-center text-muted-foreground",children:"Loading history..."}):o.length===0?e.jsxs("div",{className:"py-12 text-center text-muted-foreground",children:[e.jsx(E,{size:48,className:"mx-auto mb-4 opacity-30"}),e.jsx("p",{className:"font-medium",children:"No saved analyses yet"}),e.jsx("p",{className:"text-sm mt-1",children:"Analyses are automatically saved when you run them."})]}):e.jsx("div",{className:"space-y-3",children:o.map(s=>{var l,i,n,g,v;return e.jsxs("div",{className:"border rounded-lg bg-card overflow-hidden",children:[e.jsx("div",{className:"p-4 cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>O(s.id),children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground mb-2",children:[e.jsx(G,{size:12}),A(s.created_at)]}),e.jsx("p",{className:"text-sm text-foreground line-clamp-2",children:s.summary}),((l=s.supplements_snapshot)==null?void 0:l.length)>0&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:[s.supplements_snapshot.length," supplements analyzed"]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx("button",{onClick:c=>{c.stopPropagation(),S(s.id)},className:"p-1.5 rounded-md hover:bg-destructive/10 text-muted-foreground hover:text-destructive transition-colors","aria-label":"Delete analysis",children:e.jsx(K,{size:16})}),p===s.id?e.jsx(V,{size:20,className:"text-muted-foreground"}):e.jsx(Y,{size:20,className:"text-muted-foreground"})]})]})}),p===s.id&&e.jsxs("div",{className:"px-4 pb-4 pt-2 border-t bg-muted/30 animate-fade-in",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mt-4",children:[((i=s.benefits)==null?void 0:i.length)>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"flex items-center gap-2 text-green-600 font-semibold mb-3 text-sm",children:[e.jsx(I,{size:16})," Expected Benefits"]}),e.jsx("ul",{className:"space-y-2",children:s.benefits.map((c,m)=>e.jsxs("li",{className:"flex gap-2 text-xs text-muted-foreground items-start",children:[e.jsx(u,{size:12,className:"mt-0.5 text-border shrink-0"}),e.jsx("span",{children:c})]},m))})]}),((n=s.synergies)==null?void 0:n.length)>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"flex items-center gap-2 text-primary font-semibold mb-3 text-sm",children:[e.jsx(C,{size:16})," Synergies"]}),e.jsx("ul",{className:"space-y-2",children:s.synergies.map((c,m)=>e.jsxs("li",{className:"flex gap-2 text-xs text-muted-foreground items-start",children:[e.jsx(u,{size:12,className:"mt-0.5 text-border shrink-0"}),e.jsx("span",{children:c})]},m))})]}),((g=s.potential_risks)==null?void 0:g.length)>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"flex items-center gap-2 text-destructive font-semibold mb-3 text-sm",children:[e.jsx(M,{size:16})," Things to Watch"]}),e.jsx("ul",{className:"space-y-2",children:s.potential_risks.map((c,m)=>e.jsxs("li",{className:"flex gap-2 text-xs text-muted-foreground items-start",children:[e.jsx(u,{size:12,className:"mt-0.5 text-border shrink-0"}),e.jsx("span",{children:c})]},m))})]})]}),((v=s.supplements_snapshot)==null?void 0:v.length)>0&&e.jsxs("div",{className:"mt-6 pt-4 border-t",children:[e.jsx("h4",{className:"text-xs font-medium text-muted-foreground mb-2",children:"Supplements at time of analysis:"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:s.supplements_snapshot.map((c,m)=>e.jsx("span",{className:"px-2 py-0.5 bg-muted rounded text-xs text-muted-foreground",children:c},m))})]})]})]},s.id)})})]})})},se=({supplements:d})=>{var s,l;const{settings:f}=Z(),{token:h}=P(),[o,y]=x.useState(null),[k,j]=x.useState(!1),[p,b]=x.useState(null),[z,S]=x.useState(!1),A=async i=>{try{const n=d.map(g=>g.name);await fetch("/api/ai/analysis-history",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`},body:JSON.stringify({summary:i.summary,benefits:i.benefits,synergies:i.synergies,potential_risks:i.potential_risks,supplements:n})})}catch(n){console.error("Failed to save analysis to history:",n)}},O=async()=>{var _;j(!0),b(null);const i=d.filter(t=>{var a,r;return((a=t.schedule)==null?void 0:a.am)&&((r=t.timing)==null?void 0:r.type)!=="relative_wake"}).map(t=>`${t.name} (${t.schedule.amPills||1} pills)`),n=d.filter(t=>{var a,r;return((a=t.schedule)==null?void 0:a.pm)&&((r=t.timing)==null?void 0:r.type)!=="relative_wake"}).map(t=>`${t.name} (${t.schedule.pmPills||1} pills)`),g=d.filter(t=>{var a;return((a=t.timing)==null?void 0:a.type)==="relative_wake"}).map(t=>{const a=t.timing.offsetMinutes||0,r=a===0?"Upon waking":`${Math.floor(a/60)}h ${a%60}m after waking`;return`${t.name} (${r})`}),v=d.filter(t=>{var a,r,N;return!((a=t.schedule)!=null&&a.am)&&!((r=t.schedule)!=null&&r.pm)&&((N=t.timing)==null?void 0:N.type)!=="relative_wake"}).map(t=>t.name),c=i.length>0?i.join(", "):"None",m=n.length>0?n.join(", "):"None",B=g.length>0?g.join(", "):"None",L=v.length>0?v.join(", "):"None";let T=(_=f.prompts)==null?void 0:_.stack_analysis;T||(T=`Analyze this daily supplement protocol:

MORNING PROTOCOL (Fixed Time):
\${morningStack}

NIGHT PROTOCOL (Fixed Time):
\${nightStack}

BIO-RHYTHM OPTIMIZED (Relative to Wake Time):
\${relativeStack}

OTHER SUPPLEMENTS (No specific time):
\${otherStack}

Please provide a comprehensive analysis in JSON format with the following keys:
- "benefits": (Array of strings) Key expected health benefits of this specific combination.
- "synergies": (Array of strings) How these specific supplements work well together (e.g. Vit D and Magnesium).
- "potential_risks": (Array of strings) Negative interactions or timing issues (e.g. taking energizing things at night).
- "summary": (String) A 2-3 sentence overall assessment of this stack's goal and effectiveness.`);const F=T.replace(/\${morningStack}/g,c).replace(/\${nightStack}/g,m).replace(/\${relativeStack}/g,B).replace(/\${otherStack}/g,L),R=f.aiModel;try{const t=await fetch("/api/ai/analyze",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`},body:JSON.stringify({model:R,prompt:F,format:"json"})});if(!t.ok)throw new Error("Analysis failed");const r=(await t.json()).choices[0].message.content,N=r.indexOf("{"),D=r.lastIndexOf("}");let w;if(N!==-1&&D!==-1){const $=r.substring(N,D+1);w=JSON.parse($)}else{const $=r.replace(/```json/g,"").replace(/```/g,"").trim();w=JSON.parse($)}y(w),await A(w)}catch(t){console.error(t),b("Failed to generate analysis. Please try again.")}finally{j(!1)}};return d.length===0||!f.aiEnabled?null:e.jsxs("section",{className:"mt-12 mb-12",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Q,{size:24,className:"text-primary"}),e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"AI Stack Analysis"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>S(!0),className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2",children:[e.jsx(E,{size:16,className:"mr-2"}),"History"]}),!o&&e.jsxs("button",{onClick:O,disabled:k,className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2",children:[e.jsx(C,{size:16,className:"mr-2"}),k?"Analyzing Protocol...":"Analyze Full Stack"]})]})]}),p&&e.jsx("div",{className:"p-4 rounded-lg bg-destructive/10 text-destructive border border-destructive/20 mb-6",children:p}),o&&e.jsxs("div",{className:"rounded-xl border bg-card text-card-foreground shadow-sm p-8 animate-fade-in",children:[e.jsxs("p",{className:"text-lg leading-relaxed mb-8 text-foreground italic border-l-4 border-primary pl-4",children:['"',o.summary,'"']}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"flex items-center gap-2 text-green-600 font-semibold mb-4",children:[e.jsx(I,{size:20})," Expected Benefits"]}),e.jsx("ul",{className:"space-y-2",children:(s=o.benefits)==null?void 0:s.map((i,n)=>e.jsxs("li",{className:"flex gap-2 text-sm text-muted-foreground items-start",children:[e.jsx(u,{size:16,className:"mt-0.5 text-border shrink-0"}),e.jsx("span",{children:i})]},n))})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"flex items-center gap-2 text-primary font-semibold mb-4",children:[e.jsx(C,{size:20})," Synergies"]}),e.jsx("ul",{className:"space-y-2",children:(l=o.synergies)==null?void 0:l.map((i,n)=>e.jsxs("li",{className:"flex gap-2 text-sm text-muted-foreground items-start",children:[e.jsx(u,{size:16,className:"mt-0.5 text-border shrink-0"}),e.jsx("span",{children:i})]},n))})]}),o.potential_risks&&o.potential_risks.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"flex items-center gap-2 text-destructive font-semibold mb-4",children:[e.jsx(M,{size:20})," Things to Watch"]}),e.jsx("ul",{className:"space-y-2",children:o.potential_risks.map((i,n)=>e.jsxs("li",{className:"flex gap-2 text-sm text-muted-foreground items-start",children:[e.jsx(u,{size:16,className:"mt-0.5 text-border shrink-0"}),e.jsx("span",{children:i})]},n))})]})]}),e.jsx("button",{onClick:()=>y(null),className:"mt-8 inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 px-4 py-2",children:"Close Analysis"})]}),e.jsx(X,{open:z,onOpenChange:S})]})};export{se as default};
