import{c as M,h as O,u as I,r as a,j as e,e as T,f as P,S as j,P as $,X as L}from"./index-BFjC1dW9.js";/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v=M("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]),F=({supplements:N,onAddSupplement:k})=>{const{settings:p}=O(),{token:S}=I(),[i,o]=a.useState(null),[g,x]=a.useState(!1),[b,f]=a.useState(null),[h,l]=a.useState([]),[d,w]=a.useState(!0),y=N.filter(s=>!s.archived),E=async()=>{x(!0),f(null);const n=`
            You are a supplement optimization expert. Analyze this supplement stack and suggest MISSING COFACTORS or complementary supplements that would enhance absorption, effectiveness, or address common deficiency pairings.

            CURRENT STACK:
            - ${y.map(t=>{var u,c;const r=[];return(u=t.schedule)!=null&&u.am&&r.push(`${t.schedule.amPills||1} AM`),(c=t.schedule)!=null&&c.pm&&r.push(`${t.schedule.pmPills||1} PM`),`${t.name} (${t.dosage}${r.length?", "+r.join("/"):""})`}).join(`
- `)}

            For each recommendation, provide:
            1. name: The supplement name (generic, not brand)
            2. reason: A concise explanation of why it complements the existing stack (1-2 sentences)
            3. priority: "ESSENTIAL" (critical cofactor), "RECOMMENDED" (notable benefit), or "OPTIONAL" (nice-to-have)
            4. dosage_suggestion: A typical daily dosage range

            Rules:
            - Do NOT recommend supplements already in the stack
            - Focus on scientifically-backed synergies (e.g., Vitamin D + K2, Zinc + Copper, Iron + Vitamin C)
            - Maximum 5 suggestions, ordered by priority
            - Return a JSON object with key "recommendations" containing an array

            Example response format:
            {
                "recommendations": [
                    {
                        "name": "Vitamin K2 (MK-7)",
                        "reason": "Essential cofactor for Vitamin D3. Directs calcium to bones instead of arteries.",
                        "priority": "ESSENTIAL",
                        "dosage_suggestion": "100-200mcg daily"
                    }
                ]
            }
        `;try{const t=await fetch("/api/ai/analyze",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${S}`},body:JSON.stringify({model:p.aiModel,prompt:n})});if(!t.ok)throw new Error("Analysis failed");const c=(await t.json()).choices[0].message.content.replace(/```json/g,"").replace(/```/g,"").trim(),R=JSON.parse(c);o(R.recommendations||[])}catch(t){console.error(t),f("Failed to get recommendations. Please try again.")}finally{x(!1)}},A=s=>{k({name:s.name,dosage:s.dosage_suggestion,reason:s.reason,schedule:{am:!0,pm:!1,amPills:1,pmPills:1},price:"",quantity:"",unitType:"pills",link:"",aiAnalysis:"",recommendedDosage:s.dosage_suggestion,sideEffects:"",rating:""}),o(n=>n.filter(t=>t.name!==s.name))},z=s=>{l(n=>[...n,s])},C=s=>{switch(s){case"ESSENTIAL":return"bg-red-500/10 text-red-600 dark:text-red-400 border-red-500/30";case"RECOMMENDED":return"bg-amber-500/10 text-amber-600 dark:text-amber-400 border-amber-500/30";default:return"bg-blue-500/10 text-blue-600 dark:text-blue-400 border-blue-500/30"}},D=s=>{const n="px-2 py-0.5 rounded-full text-xs font-semibold uppercase tracking-wide";switch(s){case"ESSENTIAL":return e.jsx("span",{className:`${n} bg-red-500/20 text-red-600 dark:text-red-400`,children:"Essential"});case"RECOMMENDED":return e.jsx("span",{className:`${n} bg-amber-500/20 text-amber-600 dark:text-amber-400`,children:"Recommended"});default:return e.jsx("span",{className:`${n} bg-blue-500/20 text-blue-600 dark:text-blue-400`,children:"Optional"})}};if(!p.aiEnabled||y.length<1)return null;const m=(i==null?void 0:i.filter(s=>!h.includes(s.name)))||[];return e.jsxs("section",{className:"mt-12 mb-12",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 cursor-pointer",onClick:()=>w(!d),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(v,{size:24,className:"text-amber-500"}),e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Stack Optimizer"}),e.jsx("span",{className:"text-xs text-muted-foreground bg-muted px-2 py-1 rounded-full",children:"AI-Powered"})]}),e.jsx("button",{className:"text-muted-foreground hover:text-foreground transition-colors",children:d?e.jsx(T,{size:20}):e.jsx(P,{size:20})})]}),d&&e.jsxs("div",{className:"rounded-xl border bg-card text-card-foreground shadow-sm p-6",children:[!i&&!g&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(v,{size:48,className:"mx-auto text-amber-500/50 mb-4"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Get AI-powered suggestions for cofactors and complementary supplements to optimize your stack."}),e.jsxs("button",{onClick:E,className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-6 py-2",children:[e.jsx(j,{size:16,className:"mr-2"}),"Get Recommendations"]})]}),g&&e.jsx("div",{className:"text-center py-12",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx(j,{size:48,className:"mx-auto text-primary mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Analyzing your stack for optimization opportunities..."})]})}),b&&e.jsx("div",{className:"p-4 rounded-lg bg-destructive/10 text-destructive border border-destructive/20 mb-4",children:b}),i&&m.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:h.length>0?"All recommendations have been addressed or dismissed.":"Your stack looks well-optimized! No additional recommendations at this time."}),e.jsx("button",{onClick:()=>{o(null),l([])},className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 px-4 py-2",children:"Refresh Analysis"})]}),m.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Based on your current stack, here are suggested additions:"}),m.map((s,n)=>e.jsx("div",{className:`p-4 rounded-lg border ${C(s.priority)} transition-all hover:shadow-md`,children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"font-semibold text-foreground",children:s.name}),D(s.priority)]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:s.reason}),e.jsxs("p",{className:"text-xs font-medium",children:["Suggested dosage: ",e.jsx("span",{className:"text-foreground",children:s.dosage_suggestion})]})]}),e.jsxs("div",{className:"flex gap-2 shrink-0",children:[e.jsxs("button",{onClick:()=>A(s),className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-xs font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-8 px-3",children:[e.jsx($,{size:14,className:"mr-1"}),"Add"]}),e.jsx("button",{onClick:()=>z(s.name),className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-xs font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-8 w-8",title:"Dismiss",children:e.jsx(L,{size:14})})]})]})},n)),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t mt-6",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("strong",{children:"Disclaimer:"})," AI-generated suggestions. Consult a healthcare professional before making changes."]}),e.jsx("button",{onClick:()=>{o(null),l([])},className:"text-xs text-primary hover:underline",children:"Refresh"})]})]})]})]})};export{F as default};
