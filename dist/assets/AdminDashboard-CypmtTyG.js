import{c as b,u as I,r as l,j as e,S as U,A as m,a as x,T as D,b as O,d as N,e as R,f as j,g as L}from"./index-DRZdevS_.js";/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S=b("ShieldCheck",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=b("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),k=()=>{const{token:n}=I(),[h,u]=l.useState([]),[a,t]=l.useState({OIDC_ISSUER:"",OIDC_AUTH_URL:"",OIDC_TOKEN_URL:"",OIDC_USERINFO_URL:"",OIDC_CLIENT_ID:"",OIDC_CLIENT_SECRET:"",OIDC_CALLBACK_URL:"",FRONTEND_URL:""}),[g,d]=l.useState(""),[p,f]=l.useState("");l.useEffect(()=>{v(),C()},[n]);const v=async()=>{try{const s=await fetch("/api/admin/users",{headers:{Authorization:`Bearer ${n}`}});s.ok&&u(await s.json())}catch(s){console.error(s)}},C=async()=>{try{const s=await fetch("/api/admin/settings",{headers:{Authorization:`Bearer ${n}`}});if(s.ok){const r=await s.json();t(c=>({...c,...r}))}}catch(s){console.error(s)}},y=async(s,r)=>{try{(await fetch(`/api/admin/users/${s}/role`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({is_admin:!r})})).ok&&(u(h.map(o=>o.id===s?{...o,is_admin:r?0:1}:o)),d("User role updated."),setTimeout(()=>d(""),3e3))}catch{f("Failed to update role")}},_=async s=>{s.preventDefault();try{(await fetch("/api/admin/settings",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(a)})).ok&&(d("Settings saved successfully. OIDC strategy updated."),setTimeout(()=>d(""),3e3))}catch{f("Failed to save settings")}},i="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2";return e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[e.jsx("div",{className:"bg-primary/10 p-3 rounded-lg",children:e.jsx(U,{size:32,className:"text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Admin Dashboard"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage users and system configurations"})]})]}),g&&e.jsx(m,{className:"mb-6 border-primary/50 bg-primary/10 text-primary",children:e.jsx(x,{children:g})}),p&&e.jsx(m,{variant:"destructive",className:"mb-6",children:e.jsx(x,{children:p})}),e.jsxs(D,{defaultValue:"users",className:"space-y-6",children:[e.jsxs(O,{children:[e.jsxs(N,{value:"users",className:"flex gap-2",children:[e.jsx(T,{size:16})," User Management"]}),e.jsxs(N,{value:"settings",className:"flex gap-2",children:[e.jsx(R,{size:16})," OIDC Configuration"]})]}),e.jsx(j,{value:"users",children:e.jsx("div",{className:"rounded-md border bg-card",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Registered Users"}),e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsxs("table",{className:"w-full caption-bottom text-sm",children:[e.jsx("thead",{className:"[&_tr]:border-b",children:e.jsxs("tr",{className:"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",children:[e.jsx("th",{className:"h-12 px-4 text-left align-middle font-medium text-muted-foreground",children:"Username"}),e.jsx("th",{className:"h-12 px-4 text-left align-middle font-medium text-muted-foreground",children:"Email"}),e.jsx("th",{className:"h-12 px-4 text-left align-middle font-medium text-muted-foreground",children:"Role"}),e.jsx("th",{className:"h-12 px-4 text-left align-middle font-medium text-muted-foreground",children:"Joined"}),e.jsx("th",{className:"h-12 px-4 text-right align-middle font-medium text-muted-foreground",children:"Actions"})]})}),e.jsx("tbody",{className:"[&_tr:last-child]:border-0",children:h.map(s=>e.jsxs("tr",{className:"border-b transition-colors hover:bg-muted/50",children:[e.jsx("td",{className:"p-4 align-middle font-medium",children:s.username}),e.jsx("td",{className:"p-4 align-middle",children:s.email||"-"}),e.jsx("td",{className:"p-4 align-middle",children:s.is_admin?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary/10 text-primary",children:[e.jsx(S,{size:12})," Admin"]}):e.jsx("span",{className:"text-muted-foreground",children:"User"})}),e.jsx("td",{className:"p-4 align-middle",children:new Date(s.created_at).toLocaleDateString()}),e.jsx("td",{className:"p-4 align-middle text-right",children:e.jsx("button",{onClick:()=>y(s.id,s.is_admin),className:`inline-flex items-center justify-center whitespace-nowrap rounded-md text-xs font-medium h-8 px-3 transition-colors ${s.is_admin?"text-destructive hover:bg-destructive/10":"text-primary hover:bg-primary/10"}`,children:s.is_admin?"Revoke Admin":"Make Admin"})})]},s.id))})]})})]})})}),e.jsx(j,{value:"settings",children:e.jsxs("div",{className:"rounded-md border bg-card p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"OIDC Identity Provider Settings"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Configure your OpenID Connect provider (e.g., Google, Auth0, Keycloak)."})]}),e.jsxs("form",{onSubmit:_,className:"space-y-4 max-w-2xl",children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsx(m,{className:"bg-muted",children:e.jsx(x,{children:"Configure redirection after successful login."})}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Frontend URL (Redirect Destination)"}),e.jsx("input",{className:i,value:a.FRONTEND_URL,onChange:s=>t({...a,FRONTEND_URL:s.target.value}),placeholder:"http://localhost:5173"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Where users are sent after OIDC login."})]}),e.jsx("div",{className:"h-px bg-border my-2"}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Issuer URL"}),e.jsx("input",{className:i,value:a.OIDC_ISSUER,onChange:s=>t({...a,OIDC_ISSUER:s.target.value}),placeholder:"https://accounts.google.com"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Client ID"}),e.jsx("input",{className:i,value:a.OIDC_CLIENT_ID,onChange:s=>t({...a,OIDC_CLIENT_ID:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Client Secret"}),e.jsx("input",{type:"password",className:i,value:a.OIDC_CLIENT_SECRET,onChange:s=>t({...a,OIDC_CLIENT_SECRET:s.target.value})})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Authorization URL"}),e.jsx("input",{className:i,value:a.OIDC_AUTH_URL,onChange:s=>t({...a,OIDC_AUTH_URL:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Token URL"}),e.jsx("input",{className:i,value:a.OIDC_TOKEN_URL,onChange:s=>t({...a,OIDC_TOKEN_URL:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"UserInfo URL"}),e.jsx("input",{className:i,value:a.OIDC_USERINFO_URL,onChange:s=>t({...a,OIDC_USERINFO_URL:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Callback URL"}),e.jsx("input",{className:i,value:a.OIDC_CALLBACK_URL,onChange:s=>t({...a,OIDC_CALLBACK_URL:s.target.value})})]})]}),e.jsx("div",{className:"pt-4",children:e.jsxs("button",{type:"submit",className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2",children:[e.jsx(L,{size:16,className:"mr-2"})," Save Settings"]})})]})]})})]})]})};export{k as default};
