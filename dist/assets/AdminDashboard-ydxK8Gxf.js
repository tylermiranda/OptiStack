import{c as b,u as L,r as n,j as e,i as y,k as C,l as S,m as D,n as N,U as _,o as I,F as U,p as w,q as R,s as O,R as T}from"./index-BFjC1dW9.js";/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A=b("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=b("Pause",[["rect",{width:"4",height:"16",x:"6",y:"4",key:"iffhe4"}],["rect",{width:"4",height:"16",x:"14",y:"4",key:"sjin7j"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=b("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k=b("ShieldAlert",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=b("ShieldCheck",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),P=()=>{const{token:o}=L(),[x,f]=n.useState([]),[a,l]=n.useState({OIDC_ISSUER:"",OIDC_AUTH_URL:"",OIDC_TOKEN_URL:"",OIDC_USERINFO_URL:"",OIDC_CLIENT_ID:"",OIDC_CLIENT_SECRET:"",OIDC_CALLBACK_URL:"",FRONTEND_URL:""}),[u,g]=n.useState(""),[r,m]=n.useState("");n.useEffect(()=>{i(),h()},[o]);const i=async()=>{try{const s=await fetch("/api/admin/users",{headers:{Authorization:`Bearer ${o}`}});s.ok&&f(await s.json())}catch(s){console.error(s)}},h=async()=>{try{const s=await fetch("/api/admin/settings",{headers:{Authorization:`Bearer ${o}`}});if(s.ok){const t=await s.json();l(c=>({...c,...t}))}}catch(s){console.error(s)}},v=async(s,t)=>{try{(await fetch(`/api/admin/users/${s}/role`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({is_admin:!t})})).ok&&(f(x.map(p=>p.id===s?{...p,is_admin:t?0:1}:p)),g("User role updated."),setTimeout(()=>g(""),3e3))}catch{m("Failed to update role")}},j=async s=>{s.preventDefault();try{(await fetch("/api/admin/settings",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify(a)})).ok&&(g("Settings saved successfully. OIDC strategy updated."),setTimeout(()=>g(""),3e3))}catch{m("Failed to save settings")}},d="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2";return e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"flex items-center gap-4 mb-6",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Admin Dashboard"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage users and system configurations"})]})}),u&&e.jsx(y,{className:"mb-6 border-primary/50 bg-primary/10 text-primary",children:e.jsx(C,{children:u})}),r&&e.jsx(y,{variant:"destructive",className:"mb-6",children:e.jsx(C,{children:r})}),e.jsxs(S,{defaultValue:"users",className:"space-y-6",children:[e.jsxs(D,{children:[e.jsxs(N,{value:"users",className:"flex gap-2",children:[e.jsx(_,{size:16})," User Management"]}),e.jsxs(N,{value:"settings",className:"flex gap-2",children:[e.jsx(I,{size:16})," OIDC Configuration"]}),e.jsxs(N,{value:"maintenance",className:"flex gap-2",children:[e.jsx(A,{size:16})," Maintenance"]}),e.jsxs(N,{value:"logs",className:"flex gap-2",children:[e.jsx(U,{size:16})," System Logs"]})]}),e.jsx(w,{value:"users",children:e.jsx("div",{className:"rounded-md border bg-card",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Registered Users"}),e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsxs("table",{className:"w-full caption-bottom text-sm",children:[e.jsx("thead",{className:"[&_tr]:border-b",children:e.jsxs("tr",{className:"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",children:[e.jsx("th",{className:"h-12 px-4 text-left align-middle font-medium text-muted-foreground",children:"Username"}),e.jsx("th",{className:"h-12 px-4 text-left align-middle font-medium text-muted-foreground",children:"Email"}),e.jsx("th",{className:"h-12 px-4 text-left align-middle font-medium text-muted-foreground",children:"Role"}),e.jsx("th",{className:"h-12 px-4 text-left align-middle font-medium text-muted-foreground",children:"Joined"}),e.jsx("th",{className:"h-12 px-4 text-right align-middle font-medium text-muted-foreground",children:"Actions"})]})}),e.jsx("tbody",{className:"[&_tr:last-child]:border-0",children:x.map(s=>e.jsxs("tr",{className:"border-b transition-colors hover:bg-muted/50",children:[e.jsx("td",{className:"p-4 align-middle font-medium",children:s.username}),e.jsx("td",{className:"p-4 align-middle",children:s.email||"-"}),e.jsx("td",{className:"p-4 align-middle",children:s.is_admin?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary/10 text-primary",children:[e.jsx(F,{size:12})," Admin"]}):e.jsx("span",{className:"text-muted-foreground",children:"User"})}),e.jsx("td",{className:"p-4 align-middle",children:new Date(s.created_at).toLocaleDateString()}),e.jsx("td",{className:"p-4 align-middle text-right",children:e.jsx("button",{onClick:()=>v(s.id,s.is_admin),className:`inline-flex items-center justify-center whitespace-nowrap rounded-md text-xs font-medium h-8 px-3 transition-colors ${s.is_admin?"text-destructive hover:bg-destructive/10":"text-primary hover:bg-primary/10"}`,children:s.is_admin?"Revoke Admin":"Make Admin"})})]},s.id))})]})})]})})}),e.jsx(w,{value:"settings",children:e.jsxs("div",{className:"rounded-md border bg-card p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"OIDC Identity Provider Settings"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Configure your OpenID Connect provider (e.g., Google, Auth0, Keycloak)."})]}),e.jsxs("form",{onSubmit:j,className:"space-y-4 max-w-2xl",children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsx(y,{className:"bg-muted",children:e.jsx(C,{children:"Configure redirection after successful login."})}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Frontend URL (Redirect Destination)"}),e.jsx("input",{className:d,value:a.FRONTEND_URL,onChange:s=>l({...a,FRONTEND_URL:s.target.value}),placeholder:"http://localhost:5173"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Where users are sent after OIDC login."})]}),e.jsx("div",{className:"h-px bg-border my-2"}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Issuer URL"}),e.jsx("input",{className:d,value:a.OIDC_ISSUER,onChange:s=>l({...a,OIDC_ISSUER:s.target.value}),placeholder:"https://accounts.google.com"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Client ID"}),e.jsx("input",{className:d,value:a.OIDC_CLIENT_ID,onChange:s=>l({...a,OIDC_CLIENT_ID:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Client Secret"}),e.jsx("input",{type:"password",className:d,value:a.OIDC_CLIENT_SECRET,onChange:s=>l({...a,OIDC_CLIENT_SECRET:s.target.value})})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Authorization URL"}),e.jsx("input",{className:d,value:a.OIDC_AUTH_URL,onChange:s=>l({...a,OIDC_AUTH_URL:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Token URL"}),e.jsx("input",{className:d,value:a.OIDC_TOKEN_URL,onChange:s=>l({...a,OIDC_TOKEN_URL:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"UserInfo URL"}),e.jsx("input",{className:d,value:a.OIDC_USERINFO_URL,onChange:s=>l({...a,OIDC_USERINFO_URL:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Callback URL"}),e.jsx("input",{className:d,value:a.OIDC_CALLBACK_URL,onChange:s=>l({...a,OIDC_CALLBACK_URL:s.target.value})})]})]}),e.jsx("div",{className:"pt-4",children:e.jsxs("button",{type:"submit",className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2",children:[e.jsx(R,{size:16,className:"mr-2"})," Save Settings"]})})]})]})}),e.jsx(w,{value:"maintenance",children:e.jsx($,{token:o})}),e.jsx(w,{value:"logs",children:e.jsx(B,{token:o})})]})]})},B=({token:o})=>{const[x,f]=n.useState([]),[a,l]=n.useState([]),[u,g]=n.useState("all"),[r,m]=n.useState(""),[i,h]=n.useState(!0),[v,j]=n.useState(!1);n.useEffect(()=>{d()},[]),n.useEffect(()=>{let t;return i&&(t=setInterval(d,3e3)),()=>clearInterval(t)},[i]),n.useEffect(()=>{let t=x;if(u!=="all"&&(t=t.filter(c=>c.level===u)),r){const c=r.toLowerCase();t=t.filter(p=>p.message.toLowerCase().includes(c)||p.level.toLowerCase().includes(c))}l(t)},[x,u,r]);const d=async()=>{i||j(!0);try{const t=await fetch("/api/admin/logs",{headers:{Authorization:`Bearer ${o}`}});if(t.ok){const c=await t.json();f(c.reverse())}}catch(t){console.error("Failed to fetch logs",t)}finally{i||j(!1)}},s=t=>{switch(t){case"error":return"text-red-500";case"warn":return"text-amber-500";default:return"text-blue-500"}};return e.jsxs("div",{className:"rounded-md border bg-card flex flex-col h-[600px]",children:[e.jsxs("div",{className:"p-4 border-b flex items-center justify-between gap-4 bg-muted/30",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsxs("div",{className:"relative flex-1 max-w-xs",children:[e.jsx(O,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx("input",{placeholder:"Search logs...",className:"flex h-9 w-full rounded-md border border-input bg-background pl-9 pr-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",value:r,onChange:t=>m(t.target.value)})]}),e.jsxs("select",{className:"h-9 rounded-md border border-input bg-background px-3 text-sm shadow-sm focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring",value:u,onChange:t=>g(t.target.value),children:[e.jsx("option",{value:"all",children:"All Levels"}),e.jsx("option",{value:"info",children:"Info"}),e.jsx("option",{value:"warn",children:"Warning"}),e.jsx("option",{value:"error",children:"Error"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>h(!i),className:`inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground h-9 px-4 py-2 ${i?"text-green-600":"text-muted-foreground"}`,title:i?"Pause Auto-refresh":"Enable Auto-refresh",children:[i?e.jsx(E,{size:16,className:"mr-2"}):e.jsx(z,{size:16,className:"mr-2"}),i?"Live":"Paused"]}),e.jsx("button",{onClick:d,disabled:v,className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground h-9 w-9",title:"Refresh Now",children:e.jsx(T,{size:16,className:v&&!i?"animate-spin":""})})]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-0 font-mono text-xs bg-black text-gray-300",children:a.length===0?e.jsx("div",{className:"flex items-center justify-center h-full text-muted-foreground",children:"No logs found"}):e.jsx("div",{className:"divide-y divide-gray-800",children:a.map((t,c)=>e.jsxs("div",{className:"flex gap-4 p-2 hover:bg-white/5 transition-colors",children:[e.jsx("span",{className:"text-gray-500 whitespace-nowrap shrink-0",children:new Date(t.timestamp).toLocaleTimeString()}),e.jsx("span",{className:`font-bold w-12 shrink-0 ${s(t.level)} uppercase`,children:t.level}),e.jsx("span",{className:"break-all whitespace-pre-wrap",children:t.message})]},c))})}),e.jsxs("div",{className:"p-2 border-t text-xs text-muted-foreground bg-muted/30 flex justify-between",children:[e.jsxs("span",{children:["Showing ",a.length," events"]}),i&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsxs("span",{className:"relative flex h-2 w-2",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-green-500"})]})," Live Updates"]})]})]})},$=({token:o})=>{const[x,f]=n.useState(!1),[a,l]=n.useState(null),u=async()=>{try{const r=await fetch("/api/admin/backup",{headers:{Authorization:`Bearer ${o}`}});if(r.ok){const m=await r.blob(),i=window.URL.createObjectURL(m),h=document.createElement("a");h.href=i,h.download=`optistack_backup_${new Date().toISOString().split("T")[0]}.db`,document.body.appendChild(h),h.click(),window.URL.revokeObjectURL(i),h.remove()}else alert("Failed to download backup")}catch(r){console.error(r),alert("Error downloading backup")}},g=async()=>{if(!a||!window.confirm("WARNING: This will overwrite the current database with the uploaded file. All current data will be replaced. The server will restart. Are you sure?"))return;f(!0);const r=new FormData;r.append("backup",a);try{const m=await fetch("/api/admin/restore",{method:"POST",headers:{Authorization:`Bearer ${o}`},body:r});if(m.ok)alert("Restore successful. The application will now reload."),setTimeout(()=>{window.location.reload()},3e3);else{const i=await m.json();alert(`Restore failed: ${i.error}`),f(!1)}}catch(m){console.error(m),alert("Error calling restore endpoint"),f(!1)}};return e.jsxs("div",{className:"rounded-md border bg-card p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5"})," Data Backup"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1 mb-4",children:"Download a full copy of your database. Keep this file safe as it contains all user data."}),e.jsx("button",{onClick:u,className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2",children:"Download Backup (.db)"})]}),e.jsxs("div",{className:"pt-8 border-t",children:[e.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2 text-destructive",children:[e.jsx(k,{className:"h-5 w-5"})," Data Restore"]}),e.jsxs(y,{variant:"destructive",className:"mt-4 mb-6 border-destructive/50 bg-destructive/10 text-destructive dark:text-red-400",children:[e.jsx(k,{className:"h-4 w-4"}),e.jsxs(C,{children:[e.jsx("strong",{children:"Danger Zone:"})," Restoring a backup will ",e.jsx("u",{children:"completely overwrite"})," the current database. This action cannot be undone."]})]}),e.jsxs("div",{className:"grid gap-4 max-w-xl",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Select Backup File"}),e.jsx("input",{type:"file",accept:".db,.sqlite",onChange:r=>l(r.target.files[0]),className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"})]}),e.jsx("button",{onClick:g,disabled:!a||x,className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-destructive text-destructive-foreground hover:bg-destructive/90 h-10 px-4 py-2 w-fit",children:x?"Restoring...":"Restore Database"})]})]})]})};export{P as default};
