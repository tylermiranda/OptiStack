import{c as D,u as H,r as d,j as e,D as $,a as I,b as L,d as B,C as M,T as F,e as J,f as R,g as _,S as O,A as P,h as U,B as q}from"./index-BFjC1dW9.js";/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g=D("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C=D("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),G=({open:l,onOpenChange:y})=>{const{token:m}=H(),[a,u]=d.useState([]),[b,f]=d.useState(!1),[x,j]=d.useState(null);d.useEffect(()=>{l&&m&&w()},[l,m]);const w=async()=>{f(!0);try{const s=await fetch("/api/ai/analysis-history",{headers:{Authorization:`Bearer ${m}`}});if(s.ok){const r=await s.json();u(r)}}catch(s){console.error("Failed to fetch analysis history:",s)}finally{f(!1)}},N=async s=>{try{(await fetch(`/api/ai/analysis-history/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${m}`}})).ok&&(u(a.filter(i=>i.id!==s)),x===s&&j(null))}catch(r){console.error("Failed to delete analysis:",r)}},z=s=>new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"}),S=s=>{j(x===s?null:s)};return e.jsx($,{open:l,onOpenChange:y,children:e.jsxs(I,{className:"max-h-[90vh] overflow-y-auto w-[95vw] sm:max-w-2xl",children:[e.jsx(L,{children:e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(C,{size:20}),"Analysis History"]})}),b?e.jsx("div",{className:"py-8 text-center text-muted-foreground",children:"Loading history..."}):a.length===0?e.jsxs("div",{className:"py-12 text-center text-muted-foreground",children:[e.jsx(C,{size:48,className:"mx-auto mb-4 opacity-30"}),e.jsx("p",{className:"font-medium",children:"No saved analyses yet"}),e.jsx("p",{className:"text-sm mt-1",children:"Analyses are automatically saved when you run them."})]}):e.jsx("div",{className:"space-y-3",children:a.map(s=>{var r,i,n,h,v;return e.jsxs("div",{className:"border rounded-lg bg-card overflow-hidden",children:[e.jsx("div",{className:"p-4 cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>S(s.id),children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground mb-2",children:[e.jsx(M,{size:12}),z(s.created_at)]}),e.jsx("p",{className:"text-sm text-foreground line-clamp-2",children:s.summary}),((r=s.supplements_snapshot)==null?void 0:r.length)>0&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:[s.supplements_snapshot.length," supplements analyzed"]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx("button",{onClick:o=>{o.stopPropagation(),N(s.id)},className:"p-1.5 rounded-md hover:bg-destructive/10 text-muted-foreground hover:text-destructive transition-colors","aria-label":"Delete analysis",children:e.jsx(F,{size:16})}),x===s.id?e.jsx(J,{size:20,className:"text-muted-foreground"}):e.jsx(R,{size:20,className:"text-muted-foreground"})]})]})}),x===s.id&&e.jsxs("div",{className:"px-4 pb-4 pt-2 border-t bg-muted/30 animate-fade-in",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mt-4",children:[((i=s.benefits)==null?void 0:i.length)>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"flex items-center gap-2 text-green-600 font-semibold mb-3 text-sm",children:[e.jsx(_,{size:16})," Expected Benefits"]}),e.jsx("ul",{className:"space-y-2",children:s.benefits.map((o,t)=>e.jsxs("li",{className:"flex gap-2 text-xs text-muted-foreground items-start",children:[e.jsx(g,{size:12,className:"mt-0.5 text-border shrink-0"}),e.jsx("span",{children:o})]},t))})]}),((n=s.synergies)==null?void 0:n.length)>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"flex items-center gap-2 text-primary font-semibold mb-3 text-sm",children:[e.jsx(O,{size:16})," Synergies"]}),e.jsx("ul",{className:"space-y-2",children:s.synergies.map((o,t)=>e.jsxs("li",{className:"flex gap-2 text-xs text-muted-foreground items-start",children:[e.jsx(g,{size:12,className:"mt-0.5 text-border shrink-0"}),e.jsx("span",{children:o})]},t))})]}),((h=s.potential_risks)==null?void 0:h.length)>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"flex items-center gap-2 text-destructive font-semibold mb-3 text-sm",children:[e.jsx(P,{size:16})," Things to Watch"]}),e.jsx("ul",{className:"space-y-2",children:s.potential_risks.map((o,t)=>e.jsxs("li",{className:"flex gap-2 text-xs text-muted-foreground items-start",children:[e.jsx(g,{size:12,className:"mt-0.5 text-border shrink-0"}),e.jsx("span",{children:o})]},t))})]})]}),((v=s.supplements_snapshot)==null?void 0:v.length)>0&&e.jsxs("div",{className:"mt-6 pt-4 border-t",children:[e.jsx("h4",{className:"text-xs font-medium text-muted-foreground mb-2",children:"Supplements at time of analysis:"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:s.supplements_snapshot.map((o,t)=>e.jsx("span",{className:"px-2 py-0.5 bg-muted rounded text-xs text-muted-foreground",children:o},t))})]})]})]},s.id)})})]})})},K=({supplements:l})=>{var s,r;const{settings:y}=U(),{token:m}=H(),[a,u]=d.useState(null),[b,f]=d.useState(!1),[x,j]=d.useState(null),[w,N]=d.useState(!1),z=async i=>{try{const n=l.map(h=>h.name);await fetch("/api/ai/analysis-history",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${m}`},body:JSON.stringify({summary:i.summary,benefits:i.benefits,synergies:i.synergies,potential_risks:i.potential_risks,supplements:n})})}catch(n){console.error("Failed to save analysis to history:",n)}},S=async()=>{f(!0),j(null);const i=l.filter(t=>{var c;return(c=t.schedule)==null?void 0:c.am}).map(t=>`${t.name} (${t.schedule.amPills||1} pills)`),n=l.filter(t=>{var c;return(c=t.schedule)==null?void 0:c.pm}).map(t=>`${t.name} (${t.schedule.pmPills||1} pills)`),h=l.filter(t=>{var c,p;return!((c=t.schedule)!=null&&c.am)&&!((p=t.schedule)!=null&&p.pm)}).map(t=>t.name),v=`
            Analyze this daily supplement protocol:
            
            MORNING PROTOCOL:
            ${i.length>0?i.join(", "):"None"}
            
            NIGHT PROTOCOL:
            ${n.length>0?n.join(", "):"None"}
            
            OTHER SUPPLEMENTS (No specific time):
            ${h.length>0?h.join(", "):"None"}
            
            Please provide a comprehensive analysis in JSON format with the following keys:
            - "benefits": (Array of strings) Key expected health benefits of this specific combination.
            - "synergies": (Array of strings) How these specific supplements work well together (e.g. Vit D and Magnesium).
            - "potential_risks": (Array of strings) Negative interactions or timing issues (e.g. taking energizing things at night).
            - "summary": (String) A 2-3 sentence overall assessment of this stack's goal and effectiveness.
        `,o=y.aiModel;try{const t=await fetch("/api/ai/analyze",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${m}`},body:JSON.stringify({model:o,prompt:v,format:"json"})});if(!t.ok)throw new Error("Analysis failed");const p=(await t.json()).choices[0].message.content,E=p.indexOf("{"),T=p.lastIndexOf("}");let k;if(E!==-1&&T!==-1){const A=p.substring(E,T+1);k=JSON.parse(A)}else{const A=p.replace(/```json/g,"").replace(/```/g,"").trim();k=JSON.parse(A)}u(k),await z(k)}catch(t){console.error(t),j("Failed to generate analysis. Please try again.")}finally{f(!1)}};return l.length===0||!y.aiEnabled?null:e.jsxs("section",{className:"mt-12 mb-12",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(q,{size:24,className:"text-primary"}),e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"AI Stack Analysis"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>N(!0),className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2",children:[e.jsx(C,{size:16,className:"mr-2"}),"History"]}),!a&&e.jsxs("button",{onClick:S,disabled:b,className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2",children:[e.jsx(O,{size:16,className:"mr-2"}),b?"Analyzing Protocol...":"Analyze Full Stack"]})]})]}),x&&e.jsx("div",{className:"p-4 rounded-lg bg-destructive/10 text-destructive border border-destructive/20 mb-6",children:x}),a&&e.jsxs("div",{className:"rounded-xl border bg-card text-card-foreground shadow-sm p-8 animate-fade-in",children:[e.jsxs("p",{className:"text-lg leading-relaxed mb-8 text-foreground italic border-l-4 border-primary pl-4",children:['"',a.summary,'"']}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"flex items-center gap-2 text-green-600 font-semibold mb-4",children:[e.jsx(_,{size:20})," Expected Benefits"]}),e.jsx("ul",{className:"space-y-2",children:(s=a.benefits)==null?void 0:s.map((i,n)=>e.jsxs("li",{className:"flex gap-2 text-sm text-muted-foreground items-start",children:[e.jsx(g,{size:16,className:"mt-0.5 text-border shrink-0"}),e.jsx("span",{children:i})]},n))})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"flex items-center gap-2 text-primary font-semibold mb-4",children:[e.jsx(O,{size:20})," Synergies"]}),e.jsx("ul",{className:"space-y-2",children:(r=a.synergies)==null?void 0:r.map((i,n)=>e.jsxs("li",{className:"flex gap-2 text-sm text-muted-foreground items-start",children:[e.jsx(g,{size:16,className:"mt-0.5 text-border shrink-0"}),e.jsx("span",{children:i})]},n))})]}),a.potential_risks&&a.potential_risks.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"flex items-center gap-2 text-destructive font-semibold mb-4",children:[e.jsx(P,{size:20})," Things to Watch"]}),e.jsx("ul",{className:"space-y-2",children:a.potential_risks.map((i,n)=>e.jsxs("li",{className:"flex gap-2 text-sm text-muted-foreground items-start",children:[e.jsx(g,{size:16,className:"mt-0.5 text-border shrink-0"}),e.jsx("span",{children:i})]},n))})]})]}),e.jsx("button",{onClick:()=>u(null),className:"mt-8 inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 px-4 py-2",children:"Close Analysis"})]}),e.jsx(G,{open:w,onOpenChange:N})]})};export{K as default};
