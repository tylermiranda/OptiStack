version: '3.8'

services:
  web:
    build: .
    ports:
      - "${PORT:-3000}:${PORT:-3000}"
    environment:
      - PORT=${PORT:-3000}
      - FRONTEND_URL=${FRONTEND_URL:-http://localhost:${PORT:-3000}}
      - OIDC_CALLBACK_URL=${OIDC_CALLBACK_URL:-http://localhost:${PORT:-3000}/auth/callback}
      # Pass through OIDC secrets from host .env
      - OIDC_ISSUER
      - OIDC_AUTH_URL
      - OIDC_TOKEN_URL
      - OIDC_USERINFO_URL
      - OIDC_CLIENT_ID
      - OIDC_CLIENT_SECRET
      - SESSION_SECRET
      - JWT_SECRET
      - ADMIN_USERNAME
      - ADMIN_PASSWORD
      - OPENROUTER_API_KEY
      - DISABLE_AUTH
    volumes:
      # Persist database across container restarts
      - optistack_data:/app/data
    restart: always

volumes:
  optistack_data:
